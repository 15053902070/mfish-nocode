<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.mfish.oauth.mapper.SsoMenuMapper">
    <insert id="insertMenu" parameterType="cn.com.mfish.oauth.entity.SsoMenu">
        insert into sso_menu
        <trim prefix="(" suffix=")" suffixOverrides=",">
            id, parent_id, client_id,menu_code, menu_level,
            <if test="menuName != null">menu_name,</if>
            <if test="menuIcon != null">menu_icon,</if>
            <if test="menuSort != null">menu_sort,</if>
            <if test="menuType != null">menu_type,</if>
            <if test="routePath != null">route_path,</if>
            <if test="component != null">component,</if>
            <if test="permissions != null">permissions,</if>
            <if test="isExternal != null">is_external,</if>
            <if test="isVisible != null">is_visible,</if>
            <if test="isKeepalive != null">is_keepalive,</if>
            <if test="remark != null">remark,</if>
            create_by, create_time
        </trim>
        select
        <trim suffixOverrides=",">
            #{id}, #{parentId}, #{clientId},
            CONCAT(IFNULL(( SELECT menu_code FROM sso_menu WHERE id = #{parentId} ), '' ),LPAD(SUBSTR(IFNULL((SELECT
            max( menu_code ) FROM sso_menu WHERE parent_id = #{parentId} ), 0 ),(lvl-1)*5+1)+ 1, 5, 0 )),
            lvl,
            <if test="menuName != null">#{menuName},</if>
            <if test="menuIcon != null">#{menuIcon},</if>
            <if test="menuSort != null">#{menuSort},</if>
            <if test="menuType != null">#{menuType},</if>
            <if test="routePath != null">#{routePath},</if>
            <if test="component != null">#{component},</if>
            <if test="permissions != null">#{permissions},</if>
            <if test="isExternal != null">#{isExternal},</if>
            <if test="isVisible != null">#{isVisible},</if>
            <if test="isKeepalive != null">#{isKeepalive},</if>
            <if test="remark != null">#{remark},</if>
            #{createBy}, now()
        </trim>
        from (select IFNULL(( SELECT menu_level FROM sso_menu WHERE id = #{parentId} ), '0' )+ 1 lvl from dual) t
    </insert>
</mapper>
